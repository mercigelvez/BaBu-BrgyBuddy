<!-- modals.html -->
{% if current_user.is_authenticated %}
    {% for chat_history in current_user.chat_histories %}
        <!-- Rename Chat Modal -->
        <div class="modal fade" id="renameChatModal{{ chat_history.id }}" tabindex="-1" aria-labelledby="renameChatModalLabel{{ chat_history.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="renameChatModalLabel{{ chat_history.id }}">Rename Chat</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" class="form-control" id="newChatTitle{{ chat_history.id }}" value="{{ chat_history.title or 'Untitled' }}" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary rename-chat-confirm" data-chat-history-id="{{ chat_history.id }}">Rename</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Chat Modal -->
        <div class="modal fade" id="deleteChatModal{{ chat_history.id }}" tabindex="-1" aria-labelledby="deleteChatModalLabel{{ chat_history.id }}" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content modal-dialog-centered">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteChatModalLabel{{ chat_history.id }}">Delete Chat</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">Are you sure you want to delete this chat?</div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger delete-chat-confirm" data-chat-history-id="{{ chat_history.id }}">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endif %}

<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header" style="border-bottom: 3px solid #000; padding: 0.2rem;">
          <h5 class="modal-title" id="profileModalLabel" style="margin: 2%;">Profile</h5>
          <div class="ml-auto">
            <button type="button" class="btn btn-sm black-button mt-3" id="editProfileBtn">Edit</button>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="background-color: black; color:white; border-radius: 49%;font-size: 0.5rem;"><span aria-hidden="true"><i class="fas fa-times fa-sm"></i></span></button>
          </div>
        </div>
        <form id="profileForm" method="POST" action="{{ url_for('home_blueprint.update_profile') }}">
          <div class="modal-body">
            <div class="form-group row">
              <label for="usernameInput" class="col-sm-2 fs-6 col-form-label">Username:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="usernameInput" name="username" value="{{ current_user.username }}" pattern="^[a-zA-Z0-9_]+$" disabled />
                <div class="invalid-feedback">Username is invalid. Right Format: <br> <ul> 
                  <li> Number </li> 
                  <li>Underscore</li>
                  <li> Special Character </li>
                  <li> No Spaces </li>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label for="emailInput" class="col-sm-2 col-form-label">Email: </label>
              <div class="col-sm-8">
                <input type="email" class="form-control" id="emailInput" name="email" value="{{ current_user.email }}" readonly />
              </div>
            </div>
            <!-- Current Password -->
            <div class="form-group row" style="margin-bottom: -5px;">
              <label for="currentPasswordInput" class="col-sm-2 col-form-label">Current Password</label>
              <div class="col-sm-8">
                <input type="password" class="form-control" id="currentPasswordInput" name="current_password" required disabled />
                <div class="invalid-feedback">Please enter your current password.</div>
              </div>
            </div>
             <!-- Instruction Message -->
             <div class="form-group row">
              <div class="col-sm-12">
                <p class="text-muted" style="margin-left: 5px; font-size: small; margin-bottom: 5px;">Note: Please enter your current password to save any changes to your profile.</p>
              </div>
            </div>
            <!-- New Password -->
            <div class="form-group row">
              <label for="newPasswordInput" class="col-sm-2 col-form-label">New Password</label>
              <div class="col-sm-8">
                <input type="password" class="form-control" id="newPasswordInput" name="new_password" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$" disabled />
                <div class="invalid-feedback">Password must be at least 6 characters long, contain at least one uppercase letter, one lowercase letter, one digit, and one special character.</div>
              </div>
            </div>
          </div>
          <div class="modal-footer ml-auto">
            <button type="button" class="btn ml-auto" id="saveChangesBtn" style="background-color: #000; color: white;">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
</div>
  <!-- End Profile Modal -->

    <!-- Logout Modal -->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header ml-auto">
            <h5 class="modal-title" id="logoutModalLabel"></h5>
            <button type="button" class="close ml-auto" data-dismiss="modal" aria-label="Close" style="background-color: black; color:white; border-radius: 49%;font-size: 0.5rem;"><span aria-hidden="true"><i class="fas fa-times fa-sm"></i></span></button>
          </div>
          <div class="modal-body fs-5 text-center">Are you sure you want to leave BaBu?</div>
          <div class="modal-footer justify-content-center">
            <a class="btn black-button" href="{{ url_for('authentication_blueprint.logout') }}">Yes</a>
            <button type="btn black-button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Logout Modal -->